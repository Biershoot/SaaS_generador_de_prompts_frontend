<div class="prompt-generator-container">
  <!-- Header principal -->
  <div class="header">
    <div class="header-content">
      <h1 class="app-title">PromptGenius</h1>
      
      <nav class="nav-tabs">
        <button 
          mat-button 
          [class.active]="activeTab === 'generator'"
          (click)="activeTab = 'generator'">
          Generador
        </button>
        <button 
          mat-button 
          [class.active]="activeTab === 'history'"
          (click)="activeTab = 'history'">
          Historial
        </button>
        <button 
          mat-button 
          [class.active]="activeTab === 'favorites'"
          (click)="activeTab = 'favorites'">
          Favoritos
        </button>
      </nav>
      
      <div class="user-menu">
        Usuario
      </div>
    </div>
  </div>

  <!-- Contenido principal -->
  <div class="main-content">
    <!-- Sección del generador -->
    <div class="generator-section">
      <h1 class="section-title">
        Generador de Prompts IA
      </h1>

      <!-- Controles de selección con mejor espaciado -->
      <div class="selection-controls">
        <mat-form-field appearance="outline" class="provider-select">
          <mat-label>Proveedor de IA*</mat-label>
          <mat-select [(ngModel)]="selectedProvider">
            <mat-option *ngFor="let provider of providers" [value]="provider.value">
              {{ provider.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="category-select">
          <mat-label>Categoría*</mat-label>
          <mat-select [(ngModel)]="selectedCategory">
            <mat-option *ngFor="let category of categories" [value]="category.value">
              {{ category.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Área de entrada del prompt -->
      <mat-form-field appearance="outline" class="prompt-input">
        <mat-label>Escribe tu prompt*</mat-label>
        <textarea 
          matInput 
          [(ngModel)]="promptInput"
          (input)="onPromptInputChange()"
          rows="6"
          placeholder="hola hazme un promt con sobre mi video extremo para youtube"
          maxlength="500">
        </textarea>
        <mat-hint align="end">{{ characterCount }}/{{ maxCharacters }}</mat-hint>
        <mat-error *ngIf="promptInput.length < 5 && promptInput.length > 0">
          Mínimo 5 caracteres
        </mat-error>
      </mat-form-field>

      <div class="input-hint">Mínimo 5 caracteres</div>

      <!-- Botones de acción -->
      <div class="action-buttons">
        <button 
          mat-raised-button 
          color="primary" 
          (click)="generate()"
          [disabled]="isLoading || !promptInput.trim() || promptInput.length < 5"
          class="generate-btn">
          <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
          {{ isLoading ? 'Generando...' : 'Generar Prompt' }}
        </button>
        
        <button 
          mat-button 
          color="warn" 
          (click)="clearForm()"
          class="clear-btn">
          Limpiar
        </button>
      </div>

      <!-- Resultado generado -->
      <div *ngIf="generatedPrompt" class="result-section">
        <div class="result-header">
          <h3>
            Prompt Generado
          </h3>
          <div class="result-actions">
            <button mat-icon-button (click)="copyToClipboard(generatedPrompt)" matTooltip="Copiar">
              Copiar
            </button>
            <button mat-icon-button (click)="toggleFavorite({id: 'current', generated: generatedPrompt})" matTooltip="Guardar en favoritos">
              Favorito
            </button>
          </div>
        </div>
        
        <div class="prompt-result">
          <p>{{ generatedPrompt }}</p>
        </div>
      </div>
    </div>

    <!-- Pestañas de historial, favoritos y categorías -->
    <div class="tabs-section">
      <mat-tab-group [(selectedIndex)]="activeTab" class="custom-tabs">
        <mat-tab label="Historial">
          <div class="tab-content">
            <div class="tab-watermark">historial</div>
            
            <div *ngIf="historyPrompts.length === 0" class="empty-state">
              <h3>No hay prompts en el historial</h3>
              <p>Los prompts generados aparecerán aquí</p>
            </div>

            <div *ngIf="historyPrompts.length > 0" class="prompts-list">
              <div *ngFor="let prompt of historyPrompts" class="prompt-item">
                <div class="prompt-header">
                  <div class="prompt-meta">
                    <mat-chip-set>
                      <mat-chip>{{ getProviderLabel(prompt.provider) }}</mat-chip>
                      <mat-chip>{{ getCategoryLabel(prompt.category) }}</mat-chip>
                    </mat-chip-set>
                    <span class="timestamp">{{ prompt.timestamp | date:'short' }}</span>
                  </div>
                  <div class="prompt-actions">
                    <button mat-icon-button (click)="copyToClipboard(prompt.generated)" matTooltip="Copiar">
                      Copiar
                    </button>
                    <button mat-icon-button (click)="toggleFavorite(prompt)" matTooltip="Favorito">
                      {{ prompt.isFavorite ? 'Favorito' : 'No Favorito' }}
                    </button>
                    <button mat-icon-button (click)="deletePrompt(prompt, historyPrompts)" matTooltip="Eliminar">
                      Eliminar
                    </button>
                  </div>
                </div>
                <div class="prompt-content">
                  <p class="prompt-input-text"><strong>Entrada:</strong> {{ prompt.input }}</p>
                  <p class="prompt-generated-text">{{ prompt.generated }}</p>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>

        <mat-tab label="Favoritos">
          <div class="tab-content">
            <div class="tab-watermark">favoritos</div>
            
            <div *ngIf="favoritePrompts.length === 0" class="empty-state">
              <h3>No hay prompts favoritos</h3>
              <p>Los prompts marcados como favoritos aparecerán aquí</p>
            </div>

            <div *ngIf="favoritePrompts.length > 0" class="prompts-list">
              <div *ngFor="let prompt of favoritePrompts" class="prompt-item favorite">
                <div class="prompt-header">
                  <div class="prompt-meta">
                    <mat-chip-set>
                      <mat-chip>{{ getProviderLabel(prompt.provider) }}</mat-chip>
                      <mat-chip>{{ getCategoryLabel(prompt.category) }}</mat-chip>
                    </mat-chip-set>
                    <span class="timestamp">{{ prompt.timestamp | date:'short' }}</span>
                  </div>
                  <div class="prompt-actions">
                    <button mat-icon-button (click)="copyToClipboard(prompt.generated)" matTooltip="Copiar">
                      Copiar
                    </button>
                    <button mat-icon-button (click)="toggleFavorite(prompt)" matTooltip="Quitar de favoritos">
                      Quitar Favorito
                    </button>
                    <button mat-icon-button (click)="deletePrompt(prompt, favoritePrompts)" matTooltip="Eliminar">
                      Eliminar
                    </button>
                  </div>
                </div>
                <div class="prompt-content">
                  <p class="prompt-input-text"><strong>Entrada:</strong> {{ prompt.input }}</p>
                  <p class="prompt-generated-text">{{ prompt.generated }}</p>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>

        <mat-tab label="Categorías">
          <div class="tab-content">
            <div class="tab-watermark">categorías</div>
            
            <div class="categories-grid">
              <div *ngFor="let category of categories" class="category-card">
                <h4>{{ category.label }}</h4>
                <p>{{ getCategoryDescription(category.value) }}</p>
                <button mat-button color="primary" (click)="selectCategory(category.value)">
                  Ver prompts
                </button>
              </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>
