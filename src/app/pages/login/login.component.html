<div class="auth-container">
  <mat-card class="login-card">
    <mat-card-header class="login-header">
      <mat-card-title class="login-title">
        <h2 class="title-text">Iniciar Sesión</h2>
      </mat-card-title>
      <mat-card-subtitle class="login-subtitle">
        Accede con tu email o usuario para generar prompts increíbles
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content class="login-content">
      <!-- Mensajes de error y éxito -->
      <div *ngIf="errorMessage" class="error-message">
        <mat-icon>error</mat-icon>
        {{ errorMessage }}
      </div>

      <div *ngIf="successMessage" class="success-message">
        <mat-icon>check_circle</mat-icon>
        {{ successMessage }}
      </div>

      <!-- Botón de prueba de conectividad -->
      <div class="backend-test-container">
        <button
          mat-button
          color="accent"
          (click)="testBackendConnection()"
          class="test-backend-btn">
          🔍 Probar Conexión Backend (Puerto 8080)
        </button>

        <button
          mat-button
          color="primary"
          (click)="toggleTestFeatures()"
          class="toggle-test-btn">
          {{ showTestFeatures ? '🔧 Ocultar' : '🔧 Mostrar' }} Herramientas de Testing
        </button>

        <div *ngIf="backendStatus" class="backend-status">
          <span [class]="'status-' + backendStatus.type">
            {{ backendStatus.message }}
          </span>
        </div>
      </div>

      <!-- Panel de herramientas de testing (colapsible) -->
      <div *ngIf="showTestFeatures" class="test-features-panel">
        <mat-card class="test-card">
          <mat-card-header>
            <mat-card-title>🧪 Herramientas de Diagnóstico</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p><strong>Endpoint de diagnóstico:</strong> POST /auth/test-login</p>
            <p>Esta función te permite verificar si tus credenciales existen en la base de datos sin hacer login real.</p>
            <button
              mat-raised-button
              color="accent"
              (click)="testLoginDiagnostic()"
              [disabled]="!username || !password"
              class="diagnostic-btn">
              🔍 Ejecutar Test de Diagnóstico
            </button>
          </mat-card-content>
        </mat-card>
      </div>

      <form (ngSubmit)="login()" class="auth-form">
        <!-- Campo de Usuario/Email -->
        <div class="form-field-container">
          <mat-form-field appearance="outline" class="full-width username-field">
            <mat-label>Email o Usuario</mat-label>
            <input
              matInput
              type="text"
              [(ngModel)]="username"
              name="username"
              placeholder="ejemplo@correo.com o tu_usuario"
              required
              autocomplete="username">
            <mat-icon matSuffix>person</mat-icon>
          </mat-form-field>
        </div>

        <!-- Campo de Contraseña -->
        <div class="form-field-container">
          <mat-form-field appearance="outline" class="full-width password-field">
            <mat-label>Contraseña</mat-label>
            <input
              matInput
              type="password"
              [(ngModel)]="password"
              name="password"
              placeholder="••••••••"
              required
              autocomplete="current-password">
            <mat-icon matSuffix>lock</mat-icon>
          </mat-form-field>
        </div>

        <!-- Botón de Login -->
        <div class="auth-actions">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            class="login-button"
            [disabled]="loading || !username || !password">
            <mat-icon *ngIf="loading" class="loading-icon">autorenew</mat-icon>
            <span *ngIf="!loading">Iniciar Sesión</span>
            <span *ngIf="loading">Iniciando sesión...</span>
          </button>
        </div>
      </form>

      <!-- Enlaces adicionales -->
      <div class="additional-links">
        <p class="register-link">
          ¿No tienes una cuenta?
          <a routerLink="/register" class="link">Regístrate aquí</a>
        </p>
        <a href="#" class="forgot-password-link">¿Olvidaste tu contraseña?</a>
      </div>

      <!-- Información técnica (solo en modo desarrollo) -->
      <div class="technical-info" *ngIf="showTestFeatures">
        <hr>
        <h4>📋 Información Técnica</h4>
        <ul>
          <li><strong>Backend URL:</strong> http://localhost:8080</li>
          <li><strong>Login Endpoint:</strong> POST /auth/login</li>
          <li><strong>Register Endpoint:</strong> POST /auth/register</li>
          <li><strong>Validation Endpoint:</strong> GET /auth/validate</li>
          <li><strong>Test Endpoint:</strong> POST /auth/test-login</li>
        </ul>
      </div>
    </mat-card-content>
  </mat-card>
</div>
